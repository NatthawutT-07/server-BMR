# à¸„à¸³à¸‚à¸­à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡ POG - Diagram à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™

## à¸ à¸²à¸žà¸£à¸§à¸¡à¸£à¸°à¸šà¸š

```mermaid
flowchart TB
    subgraph à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰["ðŸ‘¤ à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (Mobile App)"]
        SCAN[à¸ªà¹à¸à¸™à¸šà¸²à¸£à¹Œà¹‚à¸„à¹‰à¸”]
        SELECT[à¹€à¸¥à¸·à¸­à¸ Action]
    end

    SCAN --> SELECT
    SELECT --> ADD_REQ[à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²]
    SELECT --> MOVE_REQ[à¸¢à¹‰à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸²]
    SELECT --> DELETE_REQ[à¸¥à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²]
    SELECT --> SWAP_REQ[à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡]

    subgraph à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ["ðŸ–¥ï¸ Server"]
        PENDING[(à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£)]
        APPROVE{Admin à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´}
    end

    ADD_REQ --> PENDING
    MOVE_REQ --> PENDING
    DELETE_REQ --> PENDING
    SWAP_REQ --> PENDING

    PENDING --> APPROVE
    APPROVE -->|à¸—à¸µà¸¥à¸°à¸£à¸²à¸¢à¸à¸²à¸£| SINGLE
    APPROVE -->|à¸«à¸¥à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£| BULK

    subgraph SINGLE["à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸—à¸µà¸¥à¸°à¸£à¸²à¸¢à¸à¸²à¸£"]
        S1[à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¸²à¸¡ action]
    end

    subgraph BULK["à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸«à¸¥à¸²à¸¢à¸£à¸²à¸¢à¸à¸²à¸£ à¸žà¸£à¹‰à¸­à¸¡ Offset Tracking"]
        B1[1. à¸¥à¸šà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”]
        B2[2. à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ]
        B3[3. à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²]
        B4[4. à¸¢à¹‰à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸²]
        B5[5. à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡]
    end

    B1 --> B2 --> B3 --> B4 --> B5
```

---

## à¸à¸²à¸£à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸² (ADD)

```mermaid
flowchart TD
    START([à¸„à¸³à¸‚à¸­à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸´à¸™à¸„à¹‰à¸²]) --> VALIDATE{à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š<br/>shelf, row, index}
    VALIDATE -->|à¹„à¸¡à¹ˆà¸„à¸£à¸š| ERROR1[âŒ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸„à¸£à¸š]
    VALIDATE -->|à¸„à¸£à¸š| GET_CODE[à¸„à¹‰à¸™à¸«à¸² codeProduct]
    
    GET_CODE -->|à¹„à¸¡à¹ˆà¸žà¸š| ERROR2[âŒ à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸´à¸™à¸„à¹‰à¸²]
    GET_CODE -->|à¸žà¸š| LOCK[à¸¥à¹‡à¸­à¸„ shelf]
    
    LOCK --> SHIFT[à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸ªà¸´à¸™à¸„à¹‰à¸²à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆ index à¸™à¸µà¹‰à¹„à¸›à¸‚à¸§à¸² +1]
    SHIFT --> INSERT[à¹à¸—à¸£à¸à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡]
    INSERT --> REINDEX[à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ 1,2,3...]
    REINDEX --> RELEASE[à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„]
    RELEASE --> SUCCESS([âœ… à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ])
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: à¹€à¸žà¸´à¹ˆà¸¡à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™

```
à¸ªà¸´à¸™à¸„à¹‰à¸² A à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­ â†’ W1/Row1/Index1 (à¸‚à¸­à¸à¹ˆà¸­à¸™)
à¸ªà¸´à¸™à¸„à¹‰à¸² B à¸ªà¹ˆà¸‡à¸„à¸³à¸‚à¸­ â†’ W1/Row1/Index1 (à¸‚à¸­à¸—à¸µà¸«à¸¥à¸±à¸‡)

à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¸«à¸¥à¸±à¸‡à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´:
- A = index 1 (à¸‚à¸­à¸à¹ˆà¸­à¸™ à¹„à¸”à¹‰à¸à¹ˆà¸­à¸™)
- B = index 2 (offset +1)
```

---

## à¸à¸²à¸£à¸¢à¹‰à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸² (MOVE)

```mermaid
flowchart TD
    START([à¸„à¸³à¸‚à¸­à¸¢à¹‰à¸²à¸¢à¸ªà¸´à¸™à¸„à¹‰à¸²]) --> CHECK{à¸¢à¹‰à¸²à¸¢à¹ƒà¸™ Row à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™?}
    
    CHECK -->|à¹ƒà¸Šà¹ˆ| SAME_ROW
    CHECK -->|à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ| CROSS_ROW
    
    subgraph SAME_ROW["à¸¢à¹‰à¸²à¸¢à¹ƒà¸™ Row à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™"]
        SR1[à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡ row]
        SR2[à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸ˆà¸°à¸¢à¹‰à¸²à¸¢]
        SR3[à¸”à¸¶à¸‡à¸­à¸­à¸à¸ˆà¸²à¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸”à¸´à¸¡]
        SR4[à¹à¸—à¸£à¸à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸«à¸¡à¹ˆ]
        SR5[à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡ row]
    end
    
    subgraph CROSS_ROW["à¸¢à¹‰à¸²à¸¢à¸‚à¹‰à¸²à¸¡ Row/Shelf"]
        CR1[à¸¥à¸šà¸ˆà¸²à¸ row à¹€à¸”à¸´à¸¡]
        CR2[à¸ˆà¸±à¸” index row à¹€à¸”à¸´à¸¡]
        CR3[à¹€à¸¥à¸·à¹ˆà¸­à¸™à¸ªà¸´à¸™à¸„à¹‰à¸² row à¹ƒà¸«à¸¡à¹ˆà¹„à¸›à¸‚à¸§à¸²]
        CR4[à¹à¸—à¸£à¸à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸«à¸¡à¹ˆ]
        CR5[à¸ˆà¸±à¸” index row à¹ƒà¸«à¸¡à¹ˆ]
    end
    
    SR1 --> SR2 --> SR3 --> SR4 --> SR5 --> SUCCESS
    CR1 --> CR2 --> CR3 --> CR4 --> CR5 --> SUCCESS
    
    SUCCESS([âœ… à¸¢à¹‰à¸²à¸¢à¸ªà¸³à¹€à¸£à¹‡à¸ˆ])
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ 1: à¸¢à¹‰à¸²à¸¢à¹ƒà¸™ Row à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™

```
à¸à¹ˆà¸­à¸™: A, B, C, D, E (index 1,2,3,4,5)

à¸„à¸³à¸‚à¸­: B â†’ index 4

à¸«à¸¥à¸±à¸‡: A, C, D, B, E (index 1,2,3,4,5)
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ 2: à¸¢à¹‰à¸²à¸¢à¸‚à¹‰à¸²à¸¡ Row

```
à¸à¹ˆà¸­à¸™:
  W1/Row1: A, B, C, D, E (index 1-5)
  W1/Row2: G, H, I, J, K (index 1-5)

à¸„à¸³à¸‚à¸­: B â†’ W1/Row2/index 3

à¸«à¸¥à¸±à¸‡:
  W1/Row1: A, C, D, E (index 1-4) âœ… à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ
  W1/Row2: G, H, B, I, J, K (index 1-6) âœ… à¹à¸—à¸£à¸à¹à¸¥à¸°à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ
```

---

## à¸à¸²à¸£à¸¥à¸šà¸ªà¸´à¸™à¸„à¹‰à¸² (DELETE)

```mermaid
flowchart TD
    START([à¸„à¸³à¸‚à¸­à¸¥à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²]) --> VALIDATE{à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š<br/>shelf, row}
    VALIDATE -->|à¹„à¸¡à¹ˆà¸„à¸£à¸š| ERROR1[âŒ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸„à¸£à¸š]
    VALIDATE -->|à¸„à¸£à¸š| GET_CODE[à¸„à¹‰à¸™à¸«à¸² codeProduct]
    
    GET_CODE -->|à¹„à¸¡à¹ˆà¸žà¸š| ERROR2[âŒ à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸´à¸™à¸„à¹‰à¸²]
    GET_CODE -->|à¸žà¸š| LOCK[à¸¥à¹‡à¸­à¸„ shelf]
    
    LOCK --> DELETE[à¸¥à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²]
    DELETE -->|à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸™à¸„à¹‰à¸²| ERROR3[âŒ à¸ªà¸´à¸™à¸„à¹‰à¸²à¸–à¸¹à¸à¸¥à¸šà¹„à¸›à¹à¸¥à¹‰à¸§]
    DELETE -->|à¸¥à¸šà¹„à¸”à¹‰| REINDEX[à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ 1,2,3...]
    REINDEX --> RELEASE[à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„]
    RELEASE --> SUCCESS([âœ… à¸¥à¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ])
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: à¸¥à¸šà¸ªà¸´à¸™à¸„à¹‰à¸²

```
à¸à¹ˆà¸­à¸™: A, B, C, D, E (index 1,2,3,4,5)

à¸„à¸³à¸‚à¸­: à¸¥à¸š C

à¸«à¸¥à¸±à¸‡: A, B, D, E (index 1,2,3,4) âœ… à¸ˆà¸±à¸” index à¹ƒà¸«à¸¡à¹ˆ
```

---

## à¸à¸²à¸£à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ (SWAP)

```mermaid
flowchart TD
    START([à¸„à¸³à¸‚à¸­à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡]) --> GET_A[à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸² A]
    GET_A -->|à¹„à¸¡à¹ˆà¸žà¸š| ERROR1[âŒ à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸´à¸™à¸„à¹‰à¸² A]
    GET_A -->|à¸žà¸š| GET_B[à¸„à¹‰à¸™à¸«à¸²à¸ªà¸´à¸™à¸„à¹‰à¸² B]
    
    GET_B -->|à¹„à¸¡à¹ˆà¸žà¸š| ERROR2[âŒ à¹„à¸¡à¹ˆà¸žà¸šà¸ªà¸´à¸™à¸„à¹‰à¸² B]
    GET_B -->|à¸žà¸š| LOCK[à¸¥à¹‡à¸­à¸„ shelf]
    
    LOCK --> SWAP[à¸ªà¸¥à¸±à¸š codeProduct à¸—à¸µà¹ˆ 2 à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡]
    SWAP --> RELEASE[à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„]
    RELEASE --> SUCCESS([âœ… à¸ªà¸¥à¸±à¸šà¸ªà¸³à¹€à¸£à¹‡à¸ˆ])
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: à¸ªà¸¥à¸±à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡

```
à¸à¹ˆà¸­à¸™: A, B, C, D, E (index 1,2,3,4,5)

à¸„à¸³à¸‚à¸­: à¸ªà¸¥à¸±à¸š B à¸à¸±à¸š D

à¸«à¸¥à¸±à¸‡: A, D, C, B, E (index 1,2,3,4,5)
```

---

## à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¹à¸šà¸š Bulk

```mermaid
flowchart LR
    subgraph à¸¥à¸³à¸”à¸±à¸š["à¸¥à¸³à¸”à¸±à¸šà¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥"]
        D[1. à¸¥à¸š DELETE]
        R[2. Re-index]
        A[3. à¹€à¸žà¸´à¹ˆà¸¡ ADD]
        M[4. à¸¢à¹‰à¸²à¸¢ MOVE]
        S[5. à¸ªà¸¥à¸±à¸š SWAP]
    end
    
    D --> R --> A --> M --> S
```

> **à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸:** à¸—à¸¸à¸ action à¸ˆà¸°à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š `createdAt` (à¸‚à¸­à¸à¹ˆà¸­à¸™ à¸—à¸³à¸à¹ˆà¸­à¸™)

---

## à¸•à¸²à¸£à¸²à¸‡à¸ªà¸£à¸¸à¸› Edge Cases

| à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œ | à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ | à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡ |
|----------|----------|-----------|
| à¹€à¸žà¸´à¹ˆà¸¡à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¸—à¸µà¹ˆà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ | âœ… Offset tracking | à¸•à¹ˆà¸³ |
| à¸¢à¹‰à¸²à¸¢à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¸‚à¹‰à¸²à¸¡ row | âœ… Offset tracking | à¸•à¹ˆà¸³ |
| à¸¢à¹‰à¸²à¸¢à¸«à¸¥à¸²à¸¢à¸•à¸±à¸§à¹ƒà¸™ row à¹€à¸”à¸µà¸¢à¸§ | âš ï¸ à¸­à¸²à¸ˆà¸¡à¸µ conflict | à¸›à¸²à¸™à¸à¸¥à¸²à¸‡ |
| à¹€à¸žà¸´à¹ˆà¸¡ + à¸¢à¹‰à¸²à¸¢à¹ƒà¸™ row à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ | âš ï¸ Offset à¹à¸¢à¸à¸à¸±à¸™ | à¸›à¸²à¸™à¸à¸¥à¸²à¸‡ |
| à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¸žà¸£à¹‰à¸­à¸¡à¸à¸±à¸™à¸«à¸¥à¸²à¸¢ admin | âš ï¸ Lock per shelf | à¸›à¸²à¸™à¸à¸¥à¸²à¸‡ |
| à¸ªà¸´à¸™à¸„à¹‰à¸²à¸–à¸¹à¸à¸¥à¸šà¸à¹ˆà¸­à¸™à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ | âœ… à¹à¸ˆà¹‰à¸‡ Error | à¸•à¹ˆà¸³ |

---

## à¸ªà¸–à¸²à¸™à¸°à¸„à¸³à¸‚à¸­

```mermaid
stateDiagram-v2
    [*] --> à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£: à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸‚à¸­
    à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ --> à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™: Admin à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´
    à¸£à¸­à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ --> à¸›à¸à¸´à¹€à¸ªà¸˜: Admin à¸›à¸à¸´à¹€à¸ªà¸˜
    à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™ --> [*]
    à¸›à¸à¸´à¹€à¸ªà¸˜ --> [*]
```
